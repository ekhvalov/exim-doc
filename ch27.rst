
.. _ch27_00:

Транспорт **autoreply**
=======================

Транспорт **autoreply** - не истинный транспорт, в нём не происходит передачи сообщения. Вместо этого, создается новое почтовое сообщение, как автоматический ответ на входящее сообщение. Включаются строки заголовков “References:” и “Auto-Submitted:”. Они создаются согласно правилам в :rfc:`2822` и :rfc:`3834`, соответственно.

Если в маршрутизаторе передающем сообщение этому транспорту не установлен параметр **unseen**, оригинальное сообщение (для текущего получателя), не доставляется куда-либо. Однако, когда в маршрутизаторе передающем сообщение этому транспорту установлен параметр **unseen**, маршрутизация адреса продолжается таким образом, чтобы другой маршрутизатор мог выполнить нормальную доставку.

Транспорт **autoreply**, обычно, запускается как результат почтовой фильтрации, “отпускные” сообщения [#]_, - являются стандартным примером. Однако, также он может быть выполнен напрямую из маршрутизатора, как и любой другой транспорт. Для уменьшения возможных каскадов сообщений, сообщения созданные транспортом “autoreply” всегда имеют пустого отправителя, как и рикошеты.

Параметры посылаемого сообщения могут быть заданы в конфигурации путём описанных ниже параметров. Однако, они используются лишь когда адрес, передаваемый транспорту, не содержит собственной информации ответа. Когда транспорт выполняется как следствие команды **mail** или **vacation** в файле фильтра, параметры сообщения, переданные фильтром, передаются вместе с адресом. Транспортные параметры, определяющие сообщение, в таком случае игнорируются (таким образом, обычно, в этом случае они не устанавливаются). Сообщение полностью определено фильтром, или транспортом; они никогда не состоят из смеси этих параметров. Однако, параметры **file_optional**, **mode** и **return_message** применяются во всех случаях.

Транспорт **autoreply** осуществляется как локальный транспорт. При использовании его как результат команды в пользовательском файле фильтра, **autoreply**, обычно работает под uid и gid пользователя, и с соответствующими текущей и домашней директориями (смотрите главу :ref:`23 <ch23_00>`).

Есть трудноуловимое различие между маршрутизацией сообщения в транспорт **pipe**, который создаст некий текст для возвращения отправителю, и маршрутизацией его в транспорт **autoreply**. Это различие заметно лишь если обрабатывается более одного адреса в одном сообщении. В случае **pipe**, раздельные выводы от различных адресов собираются и возвращаются отправителю в одном сообщении, тогда как при использовании **autoreply** для каждого адреса создаются различные сообщения для передачи.

Непечатные символы не разрешены в строках заголовков созданных для сообщения созданного **autoreply**, за исключением символа новой строки, немедленно сопровождаемого пробелом. Если найдены любые непечатные символы, транспорт задерживается. Глобальный параметр **print_topbitchars** управляет считать ли символы с установленным высшим битом как печатные, или нет. Они не применяются непосредственно к созданному сообщению.

Если любые из общих параметров для манипуляции заголовками (например, **headers_add**) установлена в транспорте **autoreply**, они применяются к копии оригинального сообщения, включённой в созданное сообщение, когда установлена **return_message**. Они не применяются непосредственно к созданному сообщению.

Если транспорт **autoreply** получает от Exim код возврата 2 при предоставлении сообщения, указывая, что не было получателей, это не обрабатывается как ошибка. Это означает, что авто-ответы посылались на $sender_address когда она была пуста (поскольку входящее сообщение - рикошет), не вызывая проблем. Они лишь отбрасываются.


.. _ch27_01:

Частные параметры для **autoreply**
-----------------------------------

.. index::
   pair: autoreply; bcc 

=======  ==============  =============  ==============
**bcc**  Use: autoreply  Type: string†  Default: unset
=======  ==============  =============  ==============

Этим определяются адреса которые должны получать “слепые копии” (“blind carbon copies”) сообщений, когда сообщение определено транспортом.

.. index::
   pair: autoreply; cc

======  ==============  =============  ==============
**cc**  Use: autoreply  Type: string†  Default: unset
======  ==============  =============  ==============

Этим определяются получатели сообщения и содержимое заголовка “Cc:”, когда сообщение определено транспортом.

.. index::
   pair: autoreply; file

========  ==============  =============  ==============
**file**  Use: autoreply  Type: string†  Default: unset
========  ==============  =============  ==============

Содержимое файла посылается как тело сообщения, когда сообщение определено транспортом. Если установлены оба параметра - **file** и **text**, более важна текстовая строка.

.. index::
   pair: autoreply; file_expand

===============  ==============  =============  ==============
**file_expand**  Use: autoreply  Type: boolean  Default: false
===============  ==============  =============  ==============

Если это установлено, содержимое указанного параметром **file** файла подвергается раскрытию строк, и они добавляются в сообщение.

.. index::
   pair: autoreply; file_optional

=================  ==============  =============  ==============
**file_optional**  Use: autoreply  Type: boolean  Default: false
=================  ==============  =============  ==============

Если этот параметр истинна, не создается ошибка, если файл названный в параметре **file**, или пришедший с адресом не существует, или не читаем.

.. index::
   pair: autoreply; from

========  ==============  =============  ==============
**from**  Use: autoreply  Type: string†  Default: unset
========  ==============  =============  ==============

Этим определяется содержимое заголовка “From:”, когда сообщение определено транспортом.

.. index::
   pair: autoreply; headers

===========  ==============  =============  ==============
**headers**  Use: autoreply  Type: string†  Default: unset
===========  ==============  =============  ==============

Этим определяются дополнительные заголовки, согласно :rfc:822, которые должны быть добавлены к сообщению, когда сообщение определено транспортом. Можно задать несколько, путём использования “\\n” для их разделения. Проверка их формата отсутствует.

.. index::
   pair: autoreply; log

=======  ==============  =============  ==============
**log**  Use: autoreply  Type: string†  Default: unset
=======  ==============  =============  ==============

Значение этого параметра - файл, в который записывается каждое посланное сообщение, когда сообщение определено транспортом.

.. index::
   pair: autoreply; mode

========  ==============  ===================  =============
**mode**  Use: autoreply  Type: octal integer  Default: 0600
========  ==============  ===================  =============

Этот режим используется если создаётся файл логов, или файл *once*.

.. index::
   pair: autoreply; never_mail

==============  ==============  ===================  ==============
**never_mail**  Use: autoreply  Type: address list†  Default: unset
==============  ==============  ===================  ==============

Если любой запуск транспорта создаёт сообщение с получателем, который совпадает с любым элементом в этом списке, от этого получателя тихо отказываются. Если отвергнуты все получатели, не создаётся никакого сообщения. Это применяется и когда получатели созданы фильтром, и когда они заданы в транспорте.


.. index::
   pair: autoreply; once

========  ==============  =============  ==============
**once**  Use: autoreply  Type: string†  Default: unset
========  ==============  =============  ==============

Этот параметр - имя файла или БД DBM в которой сохраняются записи каждого “To:” получателя, когда сообщение определено транспортом. 

.. note:: Это не применяется к получателям “Cc:” и “Bcc:”.

Если **once** не задана, или установлена в пустую строку, сообщение всегда шлётся. По умолчанию, если **once** установлена в непустое имя файла, сообщение не шлётся, если потенциальный получатель уже перечислен в БД. Однако, если параметр **once_repeat** определяет время более нуля, сообщение посылается, если прошло столько времени с тех пор как было послано последнее сообщение этому получателю. Установка нулевого времени в **once_repeat** (по умолчанию) препятствует повторной отсылке сообщения - в этом случае, ноль - указание бесконечности.

Если **once_file_size** - ноль, база данных DBM используется для запоминания получателей, и этим ей позволяется быть любого необходимого размера. Если **once_file_size** установлена более нуля, это изменяет способ, которым Exim осуществляет параметр **once**. Вместо использования DBM базы для записи каждого получателя, он использует регулярный файл, который никогда не будет больше установленного размера.

В файле, Exim хранит линейный список адресов получателей и времён, когда им было послано сообщение. Если файл заполнен, при необходимости добавить новую запись, удаляется самый старый адрес. Если **once_repeat** не установлена, это означает, что данный получатель может получать много сообщений, но в непредсказуемых интервалах, зависящих от частоты оборота адресов в файле. Если установлена **once_repeat**, она определяет максимально время между повторениями.

.. index::
   pair: autoreply; once_file_size

==================  ==============  =============  ==========
**once_file_size**  Use: autoreply  Type: integer  Default: 0
==================  ==============  =============  ==========

Смотрите выше, параметр **once**.

.. index::
   pair: autoreply; once_repeat

===============  ==============  ===========  ===========
**once_repeat**  Use: autoreply  Type: time†  Default: 0s
===============  ==============  ===========  ===========

Смотрите выше, параметр **once**. После раскрытия, значение этого параметра должно быть допустимым значением времени.

.. index::
   pair: autoreply; replay_to

============  ==============  =============  ==============
**reply_to**  Use: autoreply  Type: string†  Default: unset
============  ==============  =============  ==============

Этим параметром определяется содержимое заголовка “Reply-To:”, когда сообщение определено транспортом.

.. index::
   pair: autoreply; return_message

==================  ==============  =============  ==============
**return_message**  Use: autoreply  Type: boolean  Default: false
==================  ==============  =============  ==============

Если этот параметр установлен, копия оригинального сообщения возвращается с новым сообщением, максимальный размер подчиняется установке глобальной конфигурационной установке **return_size_limit**.

.. index::
   pair: autoreply; subject

===========  ==============  =============  ==============
**subject**  Use: autoreply  Type: string†  Default: unset
===========  ==============  =============  ==============

Этот параметр определяет содержимое заголовка “Subject:”, когда сообщение определено транспортом. Это позволяет указывать оригинальную тему сообщения в автоматических ответах. Например::

    subject = Re: $h_subject:
   
Однако, при выполнении этого существует опасность. Это может позволить третьему лицу подписать ваших пользователей на списки рассылки, при условии, что список принимает рикошеты как подтверждение подписки. Хорошие списки требуют, чтобы подписка подтверждалась не сообщением рикошета, таким образом, опасность относительно невелика.

.. index::
   pair: autoreply; text

========  ==============  =============  ==============
**text**  Use: autoreply  Type: string†  Default: unset
========  ==============  =============  ==============

Этим параметром определяется одна строка, которая будет использоваться как тело сообщения, когда сообщение определено транспортом. Если заданы и **text** и **file**, вначале используется **text**.

.. index::
   pair: autoreply; to

======  ==============  =============  ==============
**to**  Use: autoreply  Type: string†  Default: unset
======  ==============  =============  ==============

Этим параметром определяются получатели сообщения, и содержимое заголовка “To:”, когда сообщение определено транспортом.


.. [#] видимо, автоответ пока человек в отпуске - прим lissyara
